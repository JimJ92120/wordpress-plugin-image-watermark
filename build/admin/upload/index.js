!function(){"use strict";var e,t={868:function(){const e=wp.api.WPApiBaseModel.extend({url:wpApiSettings.root+"wp/v2/settings"}),t={center:{value:15,translate:(e,t)=>[e[0]/2-t[0]/2,e[1]/2-t[1]/2]},top:{value:1,translate:(e,t)=>[e[0]/2-t[0]/2,0]},bottom:{value:2,translate:(e,t)=>[e[0]/2-t[0]/2,e[1]-t[1]]},right:{value:4,translate:(e,t)=>[e[0]-t[0],e[1]/2-t[1]/2]},left:{value:8,translate:(e,t)=>[0,e[1]/2-t[1]/2]},topRight:{value:5,translate:(e,t)=>[e[0]-t[0],0]},bottomRight:{value:6,translate:(e,t)=>[e[0]-t[0],e[1]-t[1]]},topLeft:{value:9,translate:(e,t)=>[0,0]},bottomLeft:{value:10,translate:(e,t)=>[0,e[1]-t[1]]}},a=e=>{const t=new Image;return t.src=e,new Promise((e=>{t.onload=()=>{e(t)}})).then((e=>e))},n=async(n,r)=>{const{image:i,position:o}=await(async()=>{const{image_watermark_settings:t}=await(async()=>{const t=new e;return await t.fetch({headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then((e=>{t.set(e)})),t.attributes})(),{image_id:a,position:n}=t;return(r=a,new wp.api.models.Media({id:r}).fetch()).then((e=>{const{thumbnail:t}=e.media_details.sizes;return{image:{url:t.source_url,height:t.height,width:t.width},position:Number(n)}}));var r})(),s=await(async(e,n,r,i,o,s)=>{const l=await(async(e,n,r,i,o)=>{const s=document.createElement("canvas"),l=await a(e),c=await a(n),u=((e,a,n)=>{const r=Object.keys(t).find((a=>t[a].value===e));return r&&t[r].translate?t[r].translate(a,n):[0,0]})(o,r,i),m=s.getContext("2d");return s.width=r[0],s.height=r[1],m.drawImage(l,0,0,r[0],r[1]),m.drawImage(c,u[0],u[1],i[0],i[1]),s})(e,n,r,i,o);return new Promise((e=>{l.toBlob((async t=>{e(t)}),`image/${s}`)})).then((e=>e))})(n.url,i.url,[n.width,n.height],[i.width,i.height],o,r);return((e,t,a)=>fetch(wp.api.utils.getRootUrl()+"/wp-json/wp/v2/media",{method:"POST",headers:{"X-WP-Nonce":wpApiSettings.nonce,"Content-Disposition":`attachment; filename="${t}.${a}"`,"Content-type":`image/${a}`},body:e}).then((e=>201===e.status&&e.json())).catch((e=>console.error(e))))(s,`${n.title} (marked)`,r)};wp.media.view.Attachment.Details.TwoColumn=wp.media.view.Attachment.Details.TwoColumn.extend({template(e){const t=wp.media.template("attachment-details-two-column")(e),a=document.createElement("div");return a.innerHTML=t,a.querySelector(".settings").insertAdjacentHTML("afterbegin",'<span class="image-watermark setting">\n          <label class="name">Watermark</label>\n          <button class="image-watermark__btn button button-small">Add Watermark</button>\n          <div class="image-watermark__loader">\n            <div class="image-watermark__loader-spinner"></div>\n          </div>\n        </span>'),a.innerHTML},events:{"click .image-watermark__btn":"addWatermark"},async addWatermark(){var e;const t=document.querySelector(".image-watermark__loader");t.classList.add("image-watermark__loader--active"),t.style.display="block";const{attributes:a}=this.model;await n({url:null!==(e=a.originalImageURL)&&void 0!==e?e:a.url,height:a.height,width:a.width,title:a.title},"png").then((e=>{e?confirm("New image created. See new image.")&&window.open(e.source_url,"_blank"):alert("Encountered some issues. Image has not been created.")})),t.remove()}})}},a={};function n(e){var r=a[e];if(void 0!==r)return r.exports;var i=a[e]={exports:{}};return t[e](i,i.exports,n),i.exports}n.m=t,e=[],n.O=function(t,a,r,i){if(!a){var o=1/0;for(u=0;u<e.length;u++){a=e[u][0],r=e[u][1],i=e[u][2];for(var s=!0,l=0;l<a.length;l++)(!1&i||o>=i)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(s=!1,i<o&&(o=i));if(s){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[a,r,i]},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={59:0,35:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,i,o=a[0],s=a[1],l=a[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(l)var u=l(n)}for(t&&t(a);c<o.length;c++)i=o[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},a=self.webpackChunkwordpress_plugin_image_watermark=self.webpackChunkwordpress_plugin_image_watermark||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var r=n.O(void 0,[35],(function(){return n(868)}));r=n.O(r)}();