!function(){"use strict";const t=wp.api.WPApiBaseModel.extend({url:wpApiSettings.root+"wp/v2/settings"}),e=t=>{const e=new Image;return e.src=t,e},a={center:{value:15,translate:(t,e)=>[t[0]/2-e[0]/2,t[1]/2-e[1]/2]},top:{value:1,translate:(t,e)=>[t[0]/2-e[0]/2,0]},bottom:{value:2,translate:(t,e)=>[t[0]/2-e[0]/2,t[1]-e[1]]},right:{value:4,translate:(t,e)=>[t[0]-e[0],t[1]/2-e[1]/2]},left:{value:8,translate:(t,e)=>[0,t[1]/2-e[1]/2]},topRight:{value:5,translate:(t,e)=>[t[0]-e[0],0]},bottomRight:{value:6,translate:(t,e)=>[t[0]-e[0],t[1]-e[1]]},topLeft:{value:9,translate:(t,e)=>[0,0]},bottomLeft:{value:10,translate:(t,e)=>[0,t[1]-e[1]]}};var n;n=jQuery,wp.media.view.Attachment.Details.TwoColumn=wp.media.view.Attachment.Details.TwoColumn.extend({template(t){const e=wp.media.template("attachment-details-two-column")(t),a=document.createElement("div");return a.innerHTML=e,n(a).find(".settings").prepend('<span class="image-watermark setting">\n            <label class="name">Watermark</label>\n            <span>\n              <button class="image-watermark__btn button button-small">Add Watermark</button>\n            </span>\n          </span>'),a.innerHTML},events:{"click .image-watermark__btn":"addWatermark"},async addWatermark(){var n;const{image_watermark_settings:i}=await(async()=>{const e=new t;return await e.fetch({headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then((t=>{e.set(t)})),e.attributes})(),r=await(s=i.image_id,new wp.api.models.Media({id:s}).fetch()).then((t=>{const{thumbnail:e}=t.media_details.sizes;return{url:e.source_url,height:e.height,width:e.width}}));var s;const{attributes:o}=this.model,l=await(async(t,n,i,r,s)=>fetch(await(async(t,n,i,r,s,o)=>{const l=document.createElement("canvas"),m=e(t),c=e(n),d=((t,e,n)=>{const i=Object.keys(a).find((e=>a[e].value===t));return i&&a[i].translate?a[i].translate(e,n):[0,0]})(s,i,r),u=l.getContext("2d");return l.width=i[0],l.height=i[1],new Promise((t=>{m.onload=()=>{c.onload=()=>{u.drawImage(m,0,0,i[0],i[1]),u.drawImage(c,d[0],d[1],r[0],r[1]),t()}}})).then((()=>l.toDataURL(`image/${o}`)))})(t,n,i,r,s)).then((t=>t.blob())))(null!==(n=o.originalImageURL)&&void 0!==n?n:o.url,r.url,[o.width,o.height],[r.width,r.height],Number(i.position));var m,c;(m=l,c=`${o.title} (marked)`,fetch(wp.api.utils.getRootUrl()+"/wp-json/wp/v2/media",{method:"POST",headers:{"X-WP-Nonce":wpApiSettings.nonce,"Content-Disposition":`attachment; filename="${c}.png"`,"Content-type":"image/png"},body:m})).then((t=>t.json())).then((t=>{console.log(`${t.title.rendered} created. See at ${t.source_url}`)})).catch((t=>console.error(t)))}})}();