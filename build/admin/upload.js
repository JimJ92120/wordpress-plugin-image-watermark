!function(){"use strict";const t=wp.api.WPApiBaseModel.extend({url:wpApiSettings.root+"wp/v2/settings"}),e=t=>{const e=new Image;return e.src=t,new Promise((t=>{e.onload=()=>{t(e)}})).then((t=>t))},a={center:{value:15,translate:(t,e)=>[t[0]/2-e[0]/2,t[1]/2-e[1]/2]},top:{value:1,translate:(t,e)=>[t[0]/2-e[0]/2,0]},bottom:{value:2,translate:(t,e)=>[t[0]/2-e[0]/2,t[1]-e[1]]},right:{value:4,translate:(t,e)=>[t[0]-e[0],t[1]/2-e[1]/2]},left:{value:8,translate:(t,e)=>[0,t[1]/2-e[1]/2]},topRight:{value:5,translate:(t,e)=>[t[0]-e[0],0]},bottomRight:{value:6,translate:(t,e)=>[t[0]-e[0],t[1]-e[1]]},topLeft:{value:9,translate:(t,e)=>[0,0]},bottomLeft:{value:10,translate:(t,e)=>[0,t[1]-e[1]]}};wp.media.view.Attachment.Details.TwoColumn=wp.media.view.Attachment.Details.TwoColumn.extend({template(t){const e=wp.media.template("attachment-details-two-column")(t),a=document.createElement("div");return a.innerHTML=e,a.querySelector(".settings").insertAdjacentHTML("afterbegin",'<span class="image-watermark setting">\n          <label class="name">Watermark</label>\n          <button class="image-watermark__btn button button-small">Add Watermark</button>\n        </span>'),a.innerHTML},events:{"click .image-watermark__btn":"addWatermark"},async addWatermark(){var n;const{image_watermark_settings:i}=await(async()=>{const e=new t;return await e.fetch({headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then((t=>{e.set(t)})),e.attributes})(),r=await(s=i.image_id,new wp.api.models.Media({id:s}).fetch()).then((t=>{const{thumbnail:e}=t.media_details.sizes;return{url:e.source_url,height:e.height,width:e.width}}));var s;const{attributes:o}=this.model,l=await(async(t,n,i,r,s,o)=>{const l=await(async(t,n,i,r,s)=>{const o=document.createElement("canvas"),l=await e(t),c=await e(n),m=((t,e,n)=>{const i=Object.keys(a).find((e=>a[e].value===t));return i&&a[i].translate?a[i].translate(e,n):[0,0]})(s,i,r),d=o.getContext("2d");return o.width=i[0],o.height=i[1],d.drawImage(l,0,0,i[0],i[1]),d.drawImage(c,m[0],m[1],r[0],r[1]),o})(t,n,i,r,s);return new Promise((t=>{l.toBlob((async e=>{t(e)}),"image/png")})).then((t=>t))})(null!==(n=o.originalImageURL)&&void 0!==n?n:o.url,r.url,[o.width,o.height],[r.width,r.height],Number(i.position));var c,m;(c=l,m=`${o.title} (marked)`,fetch(wp.api.utils.getRootUrl()+"/wp-json/wp/v2/media",{method:"POST",headers:{"X-WP-Nonce":wpApiSettings.nonce,"Content-Disposition":`attachment; filename="${m}.png"`,"Content-type":"image/png"},body:c})).then((t=>t.json())).then((t=>{console.log(`${t.title.rendered} created. See at ${t.source_url}`)})).catch((t=>console.error(t)))}})}();